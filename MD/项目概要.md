# 📺 OneTV-API 项目概要

## 🎯 项目简介

**OneTV-API** 是一个高度可定制的IPTV接口更新项目，主要功能是自动获取、测试和整理直播源，生成可用的IPTV播放列表。项目版本为1.7.2，基于Python 3.13开发。

### 核心价值
- ✅ 自动化获取和验证IPTV直播源
- ✅ 智能测速和质量过滤
- ✅ 多种数据源整合
- ✅ 高度可定制的频道模板
- ✅ 支持多种输出格式和协议

## 🏗️ 核心架构

### 主要组件
1. **主程序** (`main.py`) - 核心更新逻辑和调度
2. **Web服务** (`service/app.py`) - 提供HTTP接口服务
3. **GUI界面** (`tkinter_ui/`) - 图形用户界面
4. **更新模块** (`updates/`) - 各种数据源获取模块
5. **工具模块** (`utils/`) - 通用工具和配置管理

### 数据处理流程
```
数据源获取 → 频道匹配 → 测速验证 → 结果排序 → 格式输出 → Web服务
```

## 🔧 主要功能特性

### 📡 多种数据源支持
- **本地源** - 使用本地配置文件中的直播源
- **订阅源** - 从网络订阅地址批量获取
- **酒店源** - 通过FOFA/Foodie搜索酒店IPTV系统
- **组播源** - 获取组播直播源
- **关键字搜索** - 在线搜索特定频道源

### 🚀 智能优化功能
- **测速验证** - 自动测试接口响应时间、速率和分辨率
- **质量过滤** - 过滤低质量、无效源
- **IPv4/IPv6支持** - 双协议栈完整支持
- **RTMP推流** - 本地推流提升播放体验
- **EPG支持** - 电子节目指南集成

### 🎛️ 高度可定制
- **频道模板** - 自定义频道分类和名称结构
- **别名支持** - 智能频道名称别名匹配
- **黑白名单** - 精确控制源过滤规则
- **地区运营商过滤** - 按地理位置和运营商筛选
- **优先级排序** - 自定义数据源优先级

## 📁 项目结构

```
OneTV-api/
├── main.py                 # 主程序入口
├── service/
│   └── app.py             # Web服务应用
├── config/                # 配置文件目录
│   ├── config.ini         # 主配置文件
│   ├── demo.txt           # 频道模板文件
│   ├── local.txt          # 本地源配置
│   ├── subscribe.txt      # 订阅源列表
│   ├── whitelist.txt      # 白名单
│   └── blacklist.txt      # 黑名单
├── output/                # 输出结果目录
│   ├── result.m3u         # M3U格式结果
│   ├── result.txt         # TXT格式结果
│   ├── ipv4/              # IPv4专用结果
│   ├── ipv6/              # IPv6专用结果
│   └── log/               # 日志文件
├── updates/               # 数据源更新模块
│   ├── subscribe/         # 订阅源处理
│   ├── hotel/             # 酒店源处理
│   ├── multicast/         # 组播源处理
│   ├── online_search/     # 在线搜索
│   └── epg/               # EPG处理
├── utils/                 # 工具模块
│   ├── config.py          # 配置管理
│   ├── channel.py         # 频道处理
│   ├── speed.py           # 测速功能
│   └── tools.py           # 通用工具
├── tkinter_ui/            # GUI界面
├── static/                # 静态资源
└── docs/                  # 文档目录
```

## ⚙️ 配置系统

### 核心配置项
- **数据源开关** - 控制各种获取方式的启用/禁用
- **测速参数** - 并发数、超时时间、最小速率设置
- **过滤条件** - 分辨率、地区、运营商筛选规则
- **输出格式** - M3U/TXT格式，IPv4/IPv6分离选项
- **定时更新** - 支持定时自动更新（默认12小时间隔）

### 频道模板系统
使用`config/demo.txt`定义频道分类和名称：
- 支持emoji图标分类显示
- 频道别名智能匹配
- 自定义分组结构
- 灵活的频道排序

## 🌐 Web服务接口

项目提供丰富的HTTP接口：

### 基础接口
- `/` - 默认播放列表
- `/m3u` - M3U格式播放列表
- `/txt` - TXT格式播放列表

### 协议分离接口
- `/ipv4/` - IPv4专用接口
- `/ipv6/` - IPv6专用接口
- `/ipv4/txt` - IPv4 TXT格式
- `/ipv6/txt` - IPv6 TXT格式

### RTMP推流接口
- `/live/` - RTMP Live推流接口
- `/hls/` - HLS推流接口
- `/live/m3u` - Live M3U格式
- `/hls/m3u` - HLS M3U格式

### 管理接口
- `/content` - 接口文本内容
- `/log` - 测速日志查看

## 🚀 运行方式

### 1. 命令行方式
```bash
# 安装依赖
pipenv install --dev

# 启动更新
pipenv run dev

# 启动Web服务
pipenv run service
```

### 2. GUI软件
```bash
# 启动图形界面
pipenv run ui
```

### 3. Docker部署
```bash
# 拉取镜像
docker pull haohaokanya/onetv-api:latest

# 运行容器
docker run -d -p 8000:8000 haohaokanya/onetv-api

# 挂载配置（推荐）
docker run -d -p 8000:8000 \
  -v ./config:/onetv-api/config \
  -v ./output:/onetv-api/output \
  haohaokanya/onetv-api
```

### 4. GitHub Actions工作流
- Fork项目到个人仓库
- 开启Actions工作流
- 自动定时更新（每日6:00和18:00）

## 📊 输出结果

### 支持格式
- **M3U格式** - 支持EPG和频道图标显示
- **TXT格式** - 纯文本格式，兼容性好
- **IPv4/IPv6分离** - 按协议类型独立输出
- **RTMP推流版本** - 本地推流优化版本

### 结果特点
- 自动测速排序
- 质量过滤
- 重复源去除
- 更新时间标记
- 详细源信息

## 🎯 使用场景

1. **个人用户** - 获取稳定的IPTV直播源
2. **开发者** - 集成到自己的IPTV项目中
3. **运营商** - 构建IPTV服务平台
4. **媒体服务商** - 提供直播源API服务
5. **智能电视** - 为智能电视提供直播源

## 💡 技术特点

- **异步处理** - 高效的并发获取和测速
- **智能缓存** - 历史结果合并机制
- **容错设计** - 补偿机制避免空结果
- **跨平台支持** - Windows/Linux/macOS全平台
- **多架构Docker** - 支持AMD64/ARM64/ARMv7
- **模块化设计** - 易于扩展和维护

## 📈 性能优化

- 智能并发控制
- 缓存机制减少重复请求
- Host地址过滤减少测速时间
- 分辨率预过滤
- 历史数据复用

## 🔒 安全特性

- 请求超时控制
- 恶意源过滤
- 黑名单机制
- 安全的文件操作
- 容器化部署支持

---

> **免责声明**: 本项目仅供学习交流用途，接口数据均来源于网络，如有侵权，请联系删除。

> **许可证**: MIT License © 2024-PRESENT Govin
